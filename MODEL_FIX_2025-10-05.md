# Model Names Fix - October 5, 2025

## Issue

The `claude-sonnet-4` model name was failing with a 500 error:
```python
ServerError: Failed to send message
```

## Root Cause

The model name `claude-sonnet-4` does not exist in Anthropic's API. The backend was incorrectly listing it as a supported model.

## Anthropic's Actual Model Names

According to Anthropic's official documentation (https://docs.claude.com/en/docs/about-claude/models/overview), the correct model names are:

### Claude 4 Models:
- `claude-opus-4-1` → `claude-opus-4-1-20250805`
- `claude-opus-4` → `claude-opus-4-20250514`
- `claude-opus-4-0` → `claude-opus-4-20250514`
- `claude-sonnet-4-5` → `claude-sonnet-4-5-20250929` ✅ **Best for coding**
- `claude-sonnet-4-0` → `claude-sonnet-4-20250514`

### Claude 3 Models:
- `claude-3-7-sonnet-latest` → `claude-3-7-sonnet-20250219`
- `claude-3-5-haiku-latest` → `claude-3-5-haiku-20241022` ✅ **Fastest**

**Note:** `claude-sonnet-4` (without the `-0` or `-5`) **does not exist**.

## Fix Applied

### Backend Changes

**File: `services/api-gateway/src/services/ai/providers.ts`**

Updated the Anthropic provider's supported models list:
```typescript
models = [
  // Claude 4 models
  'claude-opus-4-1',
  'claude-opus-4',
  'claude-opus-4-0',
  'claude-sonnet-4-5',    // Added
  'claude-sonnet-4-0',    // Added
  // Legacy Claude 3.7 and 3.5 models
  'claude-3-7-sonnet-latest',  // Added
  'claude-3-5-haiku-latest'    // Added
];
```

**File: `services/api-gateway/src/config/index.ts`**

Updated the available models configuration:
```typescript
availableModels: parseArrayEnv('AVAILABLE_MODELS', [
  'gpt-5',
  'claude-opus-4-1',
  'claude-opus-4',
  'claude-opus-4-0',              // Added
  'claude-sonnet-4-5',            // Added
  'claude-sonnet-4-0',            // Added
  'claude-3-7-sonnet-latest',     // Added
  'claude-3-5-haiku-latest'       // Added
]),
```

### Python SDK Documentation Changes

**Files Updated:**
- `README.md` - Updated supported models section
- `QUICKSTART.md` - Updated model examples
- `SDK_UPDATE_2025-10-05.md` - Added model list

### Deployment

1. Built backend with updated models: ✅
2. Pushed new Docker image to ECR: ✅
3. Deployed to AWS ECS production: ✅
4. Verified all models working: ✅

## Testing Results

All new model names tested and working:

```bash
✅ claude-sonnet-4-5 → Returns: claude-sonnet-4-5-20250929
✅ claude-sonnet-4-0 → Returns: claude-sonnet-4-20250514
✅ claude-3-7-sonnet-latest → Returns: claude-3-7-sonnet-20250219
✅ claude-opus-4-1 → Returns: claude-opus-4-1-20250805 (already working)
✅ gpt-5 → Returns: gpt-5-2025-08-07 (already working)
```

## Updated Usage Examples

### Python SDK

```python
from chatroutes import ChatRoutes

client = ChatRoutes(api_key="your-api-key")

# Use Claude Sonnet 4.5 (best for coding)
conversation = client.conversations.create({
    'title': 'Code Review',
    'model': 'claude-sonnet-4-5'
})

response = client.messages.send(
    conversation['id'],
    {
        'content': 'Review this Python code...',
        'model': 'claude-sonnet-4-5'
    }
)

print(response['message']['content'])
print(f"Model used: {response['model']}")  # claude-sonnet-4-5-20250929
```

### Model Selection Guide

**For coding tasks:** Use `claude-sonnet-4-5`
- Best in the world for coding
- Strongest for building complex agents
- Best at using computers

**For fastest responses:** Use `claude-3-5-haiku-latest`
- Fastest Claude model
- Good for simple tasks
- Lower cost

**For most capable:** Use `claude-opus-4-1`
- Most intelligent Claude model
- Best for complex reasoning
- Higher cost

**For cost/performance balance:** Use `claude-sonnet-4-0`
- Good balance of speed and capability
- Moderate cost

**For OpenAI:** Use `gpt-5`
- Default model
- GPT-5 preview

## Migration

If you were using `claude-sonnet-4` (which never worked), switch to:

```python
# OLD (never worked)
model = 'claude-sonnet-4'

# NEW (recommended)
model = 'claude-sonnet-4-5'  # Latest Sonnet, best for coding

# OR
model = 'claude-sonnet-4-0'  # Older Sonnet 4
```

## Files Changed

### Backend
- `services/api-gateway/src/services/ai/providers.ts`
- `services/api-gateway/src/config/index.ts`

### Python SDK
- `README.md`
- `QUICKSTART.md`
- `SDK_UPDATE_2025-10-05.md`
- `MODEL_FIX_2025-10-05.md` (this file)

## Status

✅ **Fix Complete and Deployed**

- Backend: Updated and deployed to production
- Python SDK: Documentation updated
- All models: Tested and verified working
- Date: October 5, 2025
